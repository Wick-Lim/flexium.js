<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flexium vs React - Direct Comparison</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    h1 {
      color: white;
      text-align: center;
      margin-bottom: 30px;
      font-size: 2.5rem;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .comparison-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .framework-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .framework-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    .framework-logo {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 700;
      color: white;
    }

    .flexium-logo {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    .react-logo {
      background: linear-gradient(135deg, #61dafb 0%, #20232a 100%);
    }

    .framework-title {
      font-size: 1.5rem;
      font-weight: 700;
    }

    .test-controls {
      display: flex;
      gap: 12px;
      margin-bottom: 16px;
    }

    .test-btn {
      flex: 1;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .test-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .test-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .test-container {
      min-height: 200px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      padding: 16px;
      margin: 16px 0;
      background: #f7fafc;
      overflow: auto;
      max-height: 400px;
    }

    .metrics {
      display: grid;
      gap: 12px;
      margin-top: 16px;
    }

    .metric {
      display: flex;
      justify-content: space-between;
      padding: 12px;
      background: #f7fafc;
      border-radius: 6px;
      border-left: 4px solid #667eea;
    }

    .metric-label {
      font-weight: 500;
      color: #4a5568;
    }

    .metric-value {
      font-weight: 700;
      font-family: 'Monaco', monospace;
      color: #667eea;
    }

    .metric-value.winner {
      color: #48bb78;
    }

    .metric-value.loser {
      color: #f56565;
    }

    .summary-card {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    .winner-banner {
      background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      font-size: 1.5rem;
      font-weight: 700;
      margin-top: 20px;
    }

    .test-item {
      padding: 8px;
      border-bottom: 1px solid #e2e8f0;
      font-family: monospace;
      font-size: 0.875rem;
    }

    .controls {
      display: flex;
      gap: 12px;
      margin-bottom: 20px;
    }

    .control-group {
      display: flex;
      align-items: center;
      gap: 8px;
      background: white;
      padding: 12px 16px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .control-group label {
      font-weight: 600;
      color: #4a5568;
    }

    .control-group input {
      padding: 6px 12px;
      border: 2px solid #e2e8f0;
      border-radius: 4px;
      font-size: 1rem;
      width: 100px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚ö° Flexium vs React - Head-to-Head</h1>

    <div class="controls">
      <div class="control-group">
        <label>Element Count:</label>
        <input type="number" id="elementCount" value="100" min="10" max="10000" step="10">
      </div>
      <div class="control-group">
        <label>Update Count:</label>
        <input type="number" id="updateCount" value="100" min="10" max="1000" step="10">
      </div>
    </div>

    <div class="comparison-grid">
      <!-- Flexium -->
      <div class="framework-card">
        <div class="framework-header">
          <div class="framework-logo flexium-logo">F</div>
          <div class="framework-title">Flexium</div>
        </div>

        <div class="test-controls">
          <button class="test-btn" onclick="runFlexiumTest()">Run Test</button>
        </div>

        <div class="test-container" id="flexium-container"></div>

        <div class="metrics" id="flexium-metrics"></div>
      </div>

      <!-- React -->
      <div class="framework-card">
        <div class="framework-header">
          <div class="framework-logo react-logo">R</div>
          <div class="framework-title">React</div>
        </div>

        <div class="test-controls">
          <button class="test-btn" onclick="runReactTest()" style="background: linear-gradient(135deg, #61dafb 0%, #20232a 100%);">Run Test</button>
        </div>

        <div class="test-container" id="react-container"></div>

        <div class="metrics" id="react-metrics"></div>
      </div>
    </div>

    <div class="summary-card">
      <h2 style="margin-bottom: 16px; color: #667eea;">Test Results</h2>
      <div id="summary"></div>
      <div id="winner-banner"></div>
    </div>
  </div>

  <!-- Flexium -->
  <script type="module">
    import { signal, effect, batch } from '../dist/index.mjs';
    import { h, render } from '../dist/dom.mjs';

    window.flexiumSignal = signal;
    window.flexiumEffect = effect;
    window.flexiumBatch = batch;
    window.flexiumH = h;
    window.flexiumRender = render;
  </script>

  <!-- React (CDN) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <script>
    let flexiumResults = null;
    let reactResults = null;

    function formatTime(ms) {
      if (ms < 1) return `${(ms * 1000).toFixed(2)}¬µs`;
      return `${ms.toFixed(2)}ms`;
    }

    function getElementCount() {
      return parseInt(document.getElementById('elementCount').value);
    }

    function getUpdateCount() {
      return parseInt(document.getElementById('updateCount').value);
    }

    // Flexium Test
    window.runFlexiumTest = async function() {
      const container = document.getElementById('flexium-container');
      const metricsContainer = document.getElementById('flexium-metrics');
      const elementCount = getElementCount();
      const updateCount = getUpdateCount();

      container.innerHTML = 'Running...';
      metricsContainer.innerHTML = '';

      await new Promise(resolve => setTimeout(resolve, 100));

      // Test 1: Initial Render
      const renderStart = performance.now();

      const counters = Array.from({ length: elementCount }, () => window.flexiumSignal(0));

      const items = counters.map((counter, i) => {
        const div = window.flexiumH('div', {
          class: 'test-item'
        }, `Item ${i}: ${counter.value}`);

        window.flexiumEffect(() => {
          if (div instanceof HTMLElement) {
            div.textContent = `Item ${i}: ${counter.value}`;
          }
        });

        return div;
      });

      window.flexiumRender(window.flexiumH('div', {}, ...items), container);

      const renderEnd = performance.now();
      const renderTime = renderEnd - renderStart;

      await new Promise(resolve => setTimeout(resolve, 100));

      // Test 2: Updates
      const updateStart = performance.now();

      for (let i = 0; i < updateCount; i++) {
        counters[Math.floor(Math.random() * counters.length)].value++;
      }

      const updateEnd = performance.now();
      const updateTime = updateEnd - updateStart;

      // Test 3: Batch Updates
      const batchStart = performance.now();

      window.flexiumBatch(() => {
        for (let i = 0; i < updateCount; i++) {
          counters[Math.floor(Math.random() * counters.length)].value++;
        }
      });

      const batchEnd = performance.now();
      const batchTime = batchEnd - batchStart;

      // Display metrics
      flexiumResults = {
        renderTime,
        updateTime,
        batchTime,
        avgUpdateTime: updateTime / updateCount,
        avgBatchTime: batchTime / updateCount
      };

      metricsContainer.innerHTML = `
        <div class="metric">
          <span class="metric-label">Initial Render (${elementCount} items)</span>
          <span class="metric-value">${formatTime(renderTime)}</span>
        </div>
        <div class="metric">
          <span class="metric-label">Individual Updates (${updateCount}x)</span>
          <span class="metric-value">${formatTime(updateTime)}</span>
        </div>
        <div class="metric">
          <span class="metric-label">Avg per Update</span>
          <span class="metric-value">${formatTime(flexiumResults.avgUpdateTime)}</span>
        </div>
        <div class="metric">
          <span class="metric-label">Batch Updates (${updateCount}x)</span>
          <span class="metric-value">${formatTime(batchTime)}</span>
        </div>
        <div class="metric">
          <span class="metric-label">Avg per Batch Update</span>
          <span class="metric-value">${formatTime(flexiumResults.avgBatchTime)}</span>
        </div>
      `;

      updateSummary();
    };

    // React Test
    window.runReactTest = async function() {
      const container = document.getElementById('react-container');
      const metricsContainer = document.getElementById('react-metrics');
      const elementCount = getElementCount();
      const updateCount = getUpdateCount();

      container.innerHTML = 'Running...';
      metricsContainer.innerHTML = '';

      await new Promise(resolve => setTimeout(resolve, 100));

      // Test 1: Initial Render
      const renderStart = performance.now();

      function TestComponent() {
        const [items, setItems] = React.useState(
          Array.from({ length: elementCount }, (_, i) => ({ id: i, value: 0 }))
        );

        React.useEffect(() => {
          window.reactSetItems = setItems;
        }, []);

        return React.createElement('div', {},
          items.map(item =>
            React.createElement('div', {
              key: item.id,
              className: 'test-item'
            }, `Item ${item.id}: ${item.value}`)
          )
        );
      }

      const root = ReactDOM.createRoot(container);
      root.render(React.createElement(TestComponent));

      await new Promise(resolve => setTimeout(resolve, 200));

      const renderEnd = performance.now();
      const renderTime = renderEnd - renderStart;

      // Test 2: Individual Updates
      const updateStart = performance.now();

      for (let i = 0; i < updateCount; i++) {
        window.reactSetItems(items => {
          const newItems = [...items];
          const idx = Math.floor(Math.random() * newItems.length);
          newItems[idx] = { ...newItems[idx], value: newItems[idx].value + 1 };
          return newItems;
        });
        await new Promise(resolve => setTimeout(resolve, 0));
      }

      const updateEnd = performance.now();
      const updateTime = updateEnd - updateStart;

      // Test 3: Batch Updates (React automatically batches in React 18)
      const batchStart = performance.now();

      React.unstable_batchedUpdates(() => {
        for (let i = 0; i < updateCount; i++) {
          window.reactSetItems(items => {
            const newItems = [...items];
            const idx = Math.floor(Math.random() * newItems.length);
            newItems[idx] = { ...newItems[idx], value: newItems[idx].value + 1 };
            return newItems;
          });
        }
      });

      await new Promise(resolve => setTimeout(resolve, 100));

      const batchEnd = performance.now();
      const batchTime = batchEnd - batchStart;

      // Display metrics
      reactResults = {
        renderTime,
        updateTime,
        batchTime,
        avgUpdateTime: updateTime / updateCount,
        avgBatchTime: batchTime / updateCount
      };

      metricsContainer.innerHTML = `
        <div class="metric">
          <span class="metric-label">Initial Render (${elementCount} items)</span>
          <span class="metric-value">${formatTime(renderTime)}</span>
        </div>
        <div class="metric">
          <span class="metric-label">Individual Updates (${updateCount}x)</span>
          <span class="metric-value">${formatTime(updateTime)}</span>
        </div>
        <div class="metric">
          <span class="metric-label">Avg per Update</span>
          <span class="metric-value">${formatTime(reactResults.avgUpdateTime)}</span>
        </div>
        <div class="metric">
          <span class="metric-label">Batch Updates (${updateCount}x)</span>
          <span class="metric-value">${formatTime(batchTime)}</span>
        </div>
        <div class="metric">
          <span class="metric-label">Avg per Batch Update</span>
          <span class="metric-value">${formatTime(reactResults.avgBatchTime)}</span>
        </div>
      `;

      updateSummary();
    };

    function updateSummary() {
      if (!flexiumResults || !reactResults) {
        document.getElementById('summary').innerHTML = '<p>Run both tests to see comparison</p>';
        return;
      }

      const renderSpeedup = (reactResults.renderTime / flexiumResults.renderTime).toFixed(2);
      const updateSpeedup = (reactResults.avgUpdateTime / flexiumResults.avgUpdateTime).toFixed(2);
      const batchSpeedup = (reactResults.avgBatchTime / flexiumResults.avgBatchTime).toFixed(2);

      const flexiumScore =
        (reactResults.renderTime / flexiumResults.renderTime) +
        (reactResults.avgUpdateTime / flexiumResults.avgUpdateTime) +
        (reactResults.avgBatchTime / flexiumResults.avgBatchTime);

      const reactScore = 3; // Baseline

      const winner = flexiumScore > reactScore ? 'Flexium' : 'React';
      const percentage = ((Math.max(flexiumScore, reactScore) / Math.min(flexiumScore, reactScore) - 1) * 100).toFixed(0);

      document.getElementById('summary').innerHTML = `
        <div style="display: grid; gap: 16px;">
          <div class="metric">
            <span class="metric-label">Render Performance</span>
            <span class="metric-value ${renderSpeedup > 1 ? 'winner' : 'loser'}">
              Flexium is ${renderSpeedup}x ${renderSpeedup > 1 ? 'faster' : 'slower'}
            </span>
          </div>
          <div class="metric">
            <span class="metric-label">Update Performance</span>
            <span class="metric-value ${updateSpeedup > 1 ? 'winner' : 'loser'}">
              Flexium is ${updateSpeedup}x ${updateSpeedup > 1 ? 'faster' : 'slower'}
            </span>
          </div>
          <div class="metric">
            <span class="metric-label">Batch Performance</span>
            <span class="metric-value ${batchSpeedup > 1 ? 'winner' : 'loser'}">
              Flexium is ${batchSpeedup}x ${batchSpeedup > 1 ? 'faster' : 'slower'}
            </span>
          </div>
        </div>
      `;

      document.getElementById('winner-banner').innerHTML = `
        <div class="winner-banner">
          üèÜ ${winner} wins by ${percentage}% overall!
        </div>
      `;
    }

    console.log('Benchmark loaded. Click "Run Test" buttons to compare.');
  </script>
</body>
</html>
