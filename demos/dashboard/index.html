<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Interactive Dashboard - Flexium Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
      min-height: 100vh;
      padding: 2rem;
      color: #333;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 2rem;
      color: white;
    }

    h1 {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: 0.5rem;
    }

    .back-link {
      color: white;
      text-decoration: none;
      font-size: 0.95rem;
      opacity: 0.9;
      display: inline-block;
      margin-bottom: 1rem;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    .dashboard {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 1.5rem;
    }

    .widget {
      background: white;
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .widget:hover {
      transform: translateY(-4px);
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);
    }

    .widget-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
    }

    .widget-title {
      font-size: 1rem;
      font-weight: 600;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .widget-icon {
      font-size: 1.5rem;
    }

    .widget-value {
      font-size: 2.5rem;
      font-weight: 700;
      color: #1a202c;
      margin-bottom: 0.5rem;
    }

    .widget-change {
      font-size: 0.9rem;
      font-weight: 600;
    }

    .widget-change.positive {
      color: #48bb78;
    }

    .widget-change.negative {
      color: #f56565;
    }

    .stat-1 { grid-column: span 3; }
    .stat-2 { grid-column: span 3; }
    .stat-3 { grid-column: span 3; }
    .stat-4 { grid-column: span 3; }
    .chart-1 { grid-column: span 8; min-height: 300px; }
    .chart-2 { grid-column: span 4; min-height: 300px; }
    .activity { grid-column: span 6; }
    .users { grid-column: span 6; }

    .chart {
      width: 100%;
      height: 200px;
      position: relative;
    }

    .bar-chart {
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      height: 100%;
      gap: 0.5rem;
    }

    .bar {
      flex: 1;
      background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%);
      border-radius: 4px 4px 0 0;
      min-height: 4px;
      transition: all 0.5s ease;
      position: relative;
      cursor: pointer;
    }

    .bar:hover {
      opacity: 0.8;
    }

    .bar-label {
      position: absolute;
      bottom: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.75rem;
      color: #718096;
      white-space: nowrap;
    }

    .bar-value {
      position: absolute;
      top: -25px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.8rem;
      font-weight: 600;
      color: #1a202c;
    }

    .donut-chart {
      width: 150px;
      height: 150px;
      margin: 1rem auto;
      position: relative;
    }

    .donut-chart svg {
      transform: rotate(-90deg);
    }

    .donut-segment {
      transition: all 0.5s ease;
    }

    .donut-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .donut-value {
      font-size: 2rem;
      font-weight: 700;
      color: #1a202c;
    }

    .donut-label {
      font-size: 0.85rem;
      color: #718096;
    }

    .legend {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.85rem;
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 2px;
    }

    .activity-list {
      list-style: none;
    }

    .activity-item {
      padding: 1rem;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      flex-shrink: 0;
    }

    .activity-icon.blue { background: #ebf8ff; }
    .activity-icon.green { background: #f0fff4; }
    .activity-icon.purple { background: #faf5ff; }
    .activity-icon.red { background: #fff5f5; }

    .activity-content {
      flex: 1;
    }

    .activity-title {
      font-weight: 600;
      color: #1a202c;
      margin-bottom: 0.25rem;
    }

    .activity-time {
      font-size: 0.85rem;
      color: #718096;
    }

    .user-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem;
      border-bottom: 1px solid #f0f0f0;
    }

    .user-item:last-child {
      border-bottom: none;
    }

    .user-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 700;
      font-size: 1.2rem;
    }

    .user-info {
      flex: 1;
    }

    .user-name {
      font-weight: 600;
      color: #1a202c;
      margin-bottom: 0.25rem;
    }

    .user-email {
      font-size: 0.85rem;
      color: #718096;
    }

    .user-status {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .user-status.online { background: #48bb78; }
    .user-status.offline { background: #cbd5e0; }

    .controls {
      text-align: center;
      margin-top: 2rem;
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    button {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      color: white;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
    }

    .btn-success {
      background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
    }

    .btn-danger {
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    @media (max-width: 1024px) {
      .stat-1, .stat-2, .stat-3, .stat-4 { grid-column: span 6; }
      .chart-1, .chart-2 { grid-column: span 12; }
      .activity, .users { grid-column: span 12; }
    }

    @media (max-width: 640px) {
      .stat-1, .stat-2, .stat-3, .stat-4 { grid-column: span 12; }
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .updating {
      animation: pulse 1s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <a href="../index.html" class="back-link">‚Üê Back to Demos</a>
      <h1>Interactive Dashboard</h1>
      <p style="opacity: 0.9;">Real-time metrics with computed values and reactive charts</p>
    </header>

    <div class="dashboard">
      <!-- Stat Widgets -->
      <div class="widget stat-1">
        <div class="widget-header">
          <span class="widget-title">Total Revenue</span>
          <span class="widget-icon">üí∞</span>
        </div>
        <div class="widget-value" id="revenue">$0</div>
        <div class="widget-change positive" id="revenue-change">+0%</div>
      </div>

      <div class="widget stat-2">
        <div class="widget-header">
          <span class="widget-title">Active Users</span>
          <span class="widget-icon">üë•</span>
        </div>
        <div class="widget-value" id="users-count">0</div>
        <div class="widget-change positive" id="users-change">+0%</div>
      </div>

      <div class="widget stat-3">
        <div class="widget-header">
          <span class="widget-title">Conversion Rate</span>
          <span class="widget-icon">üìà</span>
        </div>
        <div class="widget-value" id="conversion">0%</div>
        <div class="widget-change negative" id="conversion-change">+0%</div>
      </div>

      <div class="widget stat-4">
        <div class="widget-header">
          <span class="widget-title">Avg. Order</span>
          <span class="widget-icon">üõí</span>
        </div>
        <div class="widget-value" id="avg-order">$0</div>
        <div class="widget-change positive" id="order-change">+0%</div>
      </div>

      <!-- Bar Chart -->
      <div class="widget chart-1">
        <div class="widget-header">
          <span class="widget-title">Weekly Sales</span>
          <span class="widget-icon">üìä</span>
        </div>
        <div class="chart">
          <div class="bar-chart" id="bar-chart"></div>
        </div>
      </div>

      <!-- Donut Chart -->
      <div class="widget chart-2">
        <div class="widget-header">
          <span class="widget-title">Traffic Sources</span>
          <span class="widget-icon">üåê</span>
        </div>
        <div class="donut-chart" id="donut-chart">
          <svg width="150" height="150">
            <circle id="segment-1" class="donut-segment" cx="75" cy="75" r="60" fill="none" stroke="#4facfe" stroke-width="20"></circle>
            <circle id="segment-2" class="donut-segment" cx="75" cy="75" r="60" fill="none" stroke="#43e97b" stroke-width="20"></circle>
            <circle id="segment-3" class="donut-segment" cx="75" cy="75" r="60" fill="none" stroke="#f093fb" stroke-width="20"></circle>
          </svg>
          <div class="donut-center">
            <div class="donut-value" id="donut-total">0</div>
            <div class="donut-label">Total</div>
          </div>
        </div>
        <div class="legend">
          <div class="legend-item">
            <div class="legend-color" style="background: #4facfe;"></div>
            <span id="legend-1">Direct: 0</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #43e97b;"></div>
            <span id="legend-2">Organic: 0</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background: #f093fb;"></div>
            <span id="legend-3">Social: 0</span>
          </div>
        </div>
      </div>

      <!-- Recent Activity -->
      <div class="widget activity">
        <div class="widget-header">
          <span class="widget-title">Recent Activity</span>
          <span class="widget-icon">‚ö°</span>
        </div>
        <ul class="activity-list" id="activity-list"></ul>
      </div>

      <!-- Top Users -->
      <div class="widget users">
        <div class="widget-header">
          <span class="widget-title">Top Users</span>
          <span class="widget-icon">üèÜ</span>
        </div>
        <div id="users-list"></div>
      </div>
    </div>

    <div class="controls">
      <button class="btn-success" id="update-data">Update Data</button>
      <button class="btn-primary" id="start-auto">Start Auto-Update</button>
      <button class="btn-danger" id="stop-auto">Stop Auto-Update</button>
    </div>
  </div>

  <script type="module">
    import { signal, computed, effect, batch } from '../../dist/index.mjs';

    // State
    const revenue = signal(45680);
    const activeUsers = signal(1234);
    const totalVisitors = signal(5678);
    const totalOrders = signal(892);
    const weeklyData = signal([120, 150, 180, 220, 190, 240, 280]);
    const trafficSources = signal({ direct: 450, organic: 320, social: 180 });

    let autoUpdateInterval = null;

    // Computed values
    const revenueChange = computed(() => {
      // Simulated change percentage
      return ((Math.random() - 0.5) * 20).toFixed(1);
    });

    const conversionRate = computed(() => {
      const rate = (totalOrders.value / totalVisitors.value * 100);
      return rate.toFixed(1);
    });

    const avgOrder = computed(() => {
      return (revenue.value / totalOrders.value).toFixed(0);
    });

    const totalTraffic = computed(() => {
      const sources = trafficSources.value;
      return sources.direct + sources.organic + sources.social;
    });

    // Update stat widgets
    effect(() => {
      document.getElementById('revenue').textContent =
        `$${revenue.value.toLocaleString()}`;
    });

    effect(() => {
      document.getElementById('users-count').textContent =
        activeUsers.value.toLocaleString();
    });

    effect(() => {
      const change = revenueChange.value;
      const el = document.getElementById('revenue-change');
      el.textContent = `${change > 0 ? '+' : ''}${change}%`;
      el.className = 'widget-change ' + (change > 0 ? 'positive' : 'negative');
    });

    effect(() => {
      document.getElementById('conversion').textContent = `${conversionRate.value}%`;
    });

    effect(() => {
      document.getElementById('avg-order').textContent = `$${avgOrder.value}`;
    });

    // Update bar chart
    effect(() => {
      const data = weeklyData.value;
      const chart = document.getElementById('bar-chart');
      const max = Math.max(...data);

      chart.innerHTML = '';
      const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

      data.forEach((value, i) => {
        const bar = document.createElement('div');
        bar.className = 'bar';
        const height = (value / max * 100);
        bar.style.height = `${height}%`;

        const label = document.createElement('div');
        label.className = 'bar-label';
        label.textContent = days[i];

        const valueLabel = document.createElement('div');
        valueLabel.className = 'bar-value';
        valueLabel.textContent = value;

        bar.appendChild(valueLabel);
        bar.appendChild(label);
        chart.appendChild(bar);
      });
    });

    // Update donut chart
    effect(() => {
      const sources = trafficSources.value;
      const total = totalTraffic.value;
      const circumference = 2 * Math.PI * 60;

      // Calculate percentages
      const directPct = sources.direct / total;
      const organicPct = sources.organic / total;
      const socialPct = sources.social / total;

      // Update segments
      const seg1 = document.getElementById('segment-1');
      const seg2 = document.getElementById('segment-2');
      const seg3 = document.getElementById('segment-3');

      // Direct (blue)
      seg1.style.strokeDasharray = `${directPct * circumference} ${circumference}`;
      seg1.style.strokeDashoffset = '0';

      // Organic (green)
      seg2.style.strokeDasharray = `${organicPct * circumference} ${circumference}`;
      seg2.style.strokeDashoffset = `-${directPct * circumference}`;

      // Social (purple)
      seg3.style.strokeDasharray = `${socialPct * circumference} ${circumference}`;
      seg3.style.strokeDashoffset = `-${(directPct + organicPct) * circumference}`;

      // Update total
      document.getElementById('donut-total').textContent = total;

      // Update legend
      document.getElementById('legend-1').textContent = `Direct: ${sources.direct}`;
      document.getElementById('legend-2').textContent = `Organic: ${sources.organic}`;
      document.getElementById('legend-3').textContent = `Social: ${sources.social}`;
    });

    // Activity feed
    const activities = [
      { icon: 'üí≥', color: 'blue', title: 'New purchase from John Doe', time: '2 min ago' },
      { icon: 'üë§', color: 'green', title: 'New user registration', time: '5 min ago' },
      { icon: '‚≠ê', color: 'purple', title: '5-star review received', time: '12 min ago' },
      { icon: 'üìß', color: 'red', title: 'Newsletter sent to 5,000 users', time: '1 hour ago' },
    ];

    const activityList = document.getElementById('activity-list');
    activities.forEach(activity => {
      const li = document.createElement('li');
      li.className = 'activity-item';
      li.innerHTML = `
        <div class="activity-icon ${activity.color}">${activity.icon}</div>
        <div class="activity-content">
          <div class="activity-title">${activity.title}</div>
          <div class="activity-time">${activity.time}</div>
        </div>
      `;
      activityList.appendChild(li);
    });

    // Top users
    const users = [
      { name: 'Alice Johnson', email: 'alice@example.com', online: true },
      { name: 'Bob Smith', email: 'bob@example.com', online: true },
      { name: 'Carol White', email: 'carol@example.com', online: false },
      { name: 'David Brown', email: 'david@example.com', online: true },
    ];

    const usersList = document.getElementById('users-list');
    users.forEach(user => {
      const div = document.createElement('div');
      div.className = 'user-item';
      const initial = user.name[0];
      div.innerHTML = `
        <div class="user-avatar">${initial}</div>
        <div class="user-info">
          <div class="user-name">${user.name}</div>
          <div class="user-email">${user.email}</div>
        </div>
        <div class="user-status ${user.online ? 'online' : 'offline'}"></div>
      `;
      usersList.appendChild(div);
    });

    // Update data function
    const updateData = () => {
      batch(() => {
        revenue.value = Math.floor(40000 + Math.random() * 20000);
        activeUsers.value = Math.floor(1000 + Math.random() * 500);
        totalVisitors.value = Math.floor(5000 + Math.random() * 2000);
        totalOrders.value = Math.floor(800 + Math.random() * 300);

        weeklyData.value = weeklyData.value.map(() =>
          Math.floor(100 + Math.random() * 200)
        );

        trafficSources.value = {
          direct: Math.floor(300 + Math.random() * 300),
          organic: Math.floor(200 + Math.random() * 200),
          social: Math.floor(100 + Math.random() * 200)
        };
      });
    };

    // Controls
    document.getElementById('update-data').onclick = updateData;

    document.getElementById('start-auto').onclick = () => {
      if (autoUpdateInterval) return;
      autoUpdateInterval = setInterval(updateData, 3000);
    };

    document.getElementById('stop-auto').onclick = () => {
      if (autoUpdateInterval) {
        clearInterval(autoUpdateInterval);
        autoUpdateInterval = null;
      }
    };

    // Initial update
    updateData();
  </script>
</body>
</html>
