<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TodoMVC - Flexium Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      min-height: 100vh;
      padding: 2rem;
      color: #333;
    }

    .container {
      max-width: 600px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 2rem;
      color: white;
    }

    h1 {
      font-size: 3rem;
      font-weight: 300;
      margin-bottom: 0.5rem;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .back-link {
      color: white;
      text-decoration: none;
      font-size: 0.95rem;
      opacity: 0.9;
      display: inline-block;
      margin-bottom: 1rem;
    }

    .back-link:hover {
      text-decoration: underline;
    }

    .todoapp {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
      overflow: hidden;
    }

    .header {
      padding: 2rem;
      background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
      color: white;
    }

    .new-todo {
      width: 100%;
      padding: 1rem 1.5rem;
      font-size: 1.2rem;
      border: none;
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.95);
      color: #333;
      outline: none;
    }

    .new-todo::placeholder {
      color: #999;
      font-style: italic;
    }

    .main {
      border-top: 1px solid #eee;
    }

    .todo-list {
      list-style: none;
    }

    .todo-item {
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      align-items: center;
      gap: 1rem;
      background: white;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .todo-item:hover {
      background: #fafafa;
    }

    .todo-item.completed .todo-text {
      text-decoration: line-through;
      opacity: 0.5;
    }

    .todo-item.editing {
      padding: 0;
    }

    .todo-checkbox {
      width: 24px;
      height: 24px;
      cursor: pointer;
      flex-shrink: 0;
    }

    .todo-text {
      flex: 1;
      font-size: 1.1rem;
      color: #333;
      word-break: break-word;
    }

    .todo-destroy {
      background: #f5576c;
      color: white;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .todo-item:hover .todo-destroy {
      opacity: 1;
    }

    .todo-destroy:hover {
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(245, 87, 108, 0.4);
    }

    .edit-input {
      width: 100%;
      padding: 1.25rem 1.5rem;
      font-size: 1.1rem;
      border: 2px solid #f093fb;
      outline: none;
    }

    .footer {
      padding: 1rem 1.5rem;
      background: #fafafa;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
      font-size: 0.9rem;
      color: #666;
    }

    .todo-count {
      font-weight: 600;
    }

    .filters {
      display: flex;
      gap: 0.5rem;
    }

    .filter-btn {
      padding: 0.4rem 0.8rem;
      border: 1px solid transparent;
      border-radius: 6px;
      background: none;
      cursor: pointer;
      font-size: 0.9rem;
      color: #666;
      transition: all 0.2s ease;
    }

    .filter-btn:hover {
      border-color: #f093fb;
    }

    .filter-btn.active {
      border-color: #f093fb;
      color: #f5576c;
      font-weight: 600;
    }

    .clear-completed {
      padding: 0.4rem 1rem;
      border: none;
      border-radius: 6px;
      background: #f5576c;
      color: white;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .clear-completed:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 12px rgba(245, 87, 108, 0.3);
    }

    .clear-completed:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
      color: #999;
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
    }

    .empty-state-text {
      font-size: 1.1rem;
    }

    .info-panel {
      background: white;
      border-radius: 16px;
      padding: 1.5rem;
      margin-top: 2rem;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
    }

    .info-title {
      font-size: 1.2rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
      color: #1a202c;
    }

    .info-list {
      list-style: none;
      color: #718096;
      line-height: 1.8;
    }

    .info-list li:before {
      content: "✓ ";
      color: #f5576c;
      font-weight: bold;
      margin-right: 0.5rem;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .todo-item {
      animation: slideIn 0.3s ease;
    }

    @media (max-width: 640px) {
      h1 { font-size: 2rem; }
      .footer {
        flex-direction: column;
        align-items: stretch;
        text-align: center;
      }
      .filters {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <a href="../index.html" class="back-link">← Back to Demos</a>
      <h1>todos</h1>
    </header>

    <div class="todoapp">
      <div class="header">
        <input
          id="new-todo"
          class="new-todo"
          placeholder="What needs to be done?"
          autofocus
        />
      </div>

      <div class="main">
        <ul id="todo-list" class="todo-list"></ul>
        <div id="empty-state" class="empty-state" style="display: none;">
          <div class="empty-state-icon">✓</div>
          <div class="empty-state-text">No todos yet. Add one above!</div>
        </div>
      </div>

      <div id="footer" class="footer" style="display: none;">
        <span class="todo-count">
          <strong id="active-count">0</strong> items left
        </span>
        <div class="filters">
          <button class="filter-btn active" data-filter="all">All</button>
          <button class="filter-btn" data-filter="active">Active</button>
          <button class="filter-btn" data-filter="completed">Completed</button>
        </div>
        <button id="clear-completed" class="clear-completed">
          Clear completed
        </button>
      </div>
    </div>

    <div class="info-panel">
      <h3 class="info-title">Features Demonstrated</h3>
      <ul class="info-list">
        <li>Add, edit, delete, and toggle todos</li>
        <li>Filter by all, active, or completed</li>
        <li>localStorage persistence (survives refresh!)</li>
        <li>Reactive computed values for counts</li>
        <li>Smooth animations on add/remove</li>
        <li>Double-click to edit inline</li>
      </ul>
    </div>
  </div>

  <script type="module">
    import { signal, computed, effect, batch } from '../../dist/index.mjs';

    // Todo item structure
    let nextId = 1;

    // State
    const todos = signal([]);
    const filter = signal('all'); // 'all' | 'active' | 'completed'
    const editingId = signal(null);

    // Load from localStorage
    const loadTodos = () => {
      try {
        const saved = localStorage.getItem('flexium-todos');
        if (saved) {
          const parsed = JSON.parse(saved);
          todos.value = parsed.todos;
          nextId = parsed.nextId;
        }
      } catch (e) {
        console.error('Failed to load todos:', e);
      }
    };

    // Save to localStorage
    const saveTodos = () => {
      try {
        localStorage.setItem('flexium-todos', JSON.stringify({
          todos: todos.value,
          nextId
        }));
      } catch (e) {
        console.error('Failed to save todos:', e);
      }
    };

    // Computed values
    const filteredTodos = computed(() => {
      const all = todos.value;
      const f = filter.value;
      if (f === 'active') return all.filter(t => !t.completed);
      if (f === 'completed') return all.filter(t => t.completed);
      return all;
    });

    const activeCount = computed(() =>
      todos.value.filter(t => !t.completed).length
    );

    const completedCount = computed(() =>
      todos.value.filter(t => t.completed).length
    );

    // Actions
    const addTodo = (text) => {
      if (!text.trim()) return;
      todos.value = [...todos.value, {
        id: nextId++,
        text: text.trim(),
        completed: false
      }];
      saveTodos();
    };

    const toggleTodo = (id) => {
      todos.value = todos.value.map(todo =>
        todo.id === id ? { ...todo, completed: !todo.completed } : todo
      );
      saveTodos();
    };

    const deleteTodo = (id) => {
      todos.value = todos.value.filter(todo => todo.id !== id);
      saveTodos();
    };

    const editTodo = (id, newText) => {
      if (!newText.trim()) {
        deleteTodo(id);
        return;
      }
      todos.value = todos.value.map(todo =>
        todo.id === id ? { ...todo, text: newText.trim() } : todo
      );
      saveTodos();
      editingId.value = null;
    };

    const clearCompleted = () => {
      todos.value = todos.value.filter(todo => !todo.completed);
      saveTodos();
    };

    // Render todo item
    const renderTodoItem = (todo) => {
      const li = document.createElement('li');
      li.className = 'todo-item' + (todo.completed ? ' completed' : '');
      li.dataset.id = todo.id;

      if (editingId.value === todo.id) {
        // Editing mode
        const input = document.createElement('input');
        input.className = 'edit-input';
        input.value = todo.text;
        input.addEventListener('blur', () => editTodo(todo.id, input.value));
        input.addEventListener('keydown', (e) => {
          if (e.key === 'Enter') {
            editTodo(todo.id, input.value);
          } else if (e.key === 'Escape') {
            editingId.value = null;
          }
        });
        li.appendChild(input);
        setTimeout(() => {
          input.focus();
          input.select();
        }, 0);
      } else {
        // Normal mode
        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.className = 'todo-checkbox';
        checkbox.checked = todo.completed;
        checkbox.addEventListener('change', () => toggleTodo(todo.id));

        const label = document.createElement('label');
        label.className = 'todo-text';
        label.textContent = todo.text;
        label.addEventListener('dblclick', () => {
          editingId.value = todo.id;
        });

        const button = document.createElement('button');
        button.className = 'todo-destroy';
        button.innerHTML = '×';
        button.addEventListener('click', () => deleteTodo(todo.id));

        li.appendChild(checkbox);
        li.appendChild(label);
        li.appendChild(button);
      }

      return li;
    };

    // Render todo list
    effect(() => {
      const list = document.getElementById('todo-list');
      const filtered = filteredTodos.value;
      const emptyState = document.getElementById('empty-state');

      // Clear list
      list.innerHTML = '';

      if (filtered.length === 0) {
        emptyState.style.display = 'block';
      } else {
        emptyState.style.display = 'none';
        filtered.forEach(todo => {
          list.appendChild(renderTodoItem(todo));
        });
      }
    });

    // Update footer
    effect(() => {
      const footer = document.getElementById('footer');
      const total = todos.value.length;
      const active = activeCount.value;
      const completed = completedCount.value;

      if (total === 0) {
        footer.style.display = 'none';
      } else {
        footer.style.display = 'flex';
        document.getElementById('active-count').textContent = active;
        const clearBtn = document.getElementById('clear-completed');
        clearBtn.disabled = completed === 0;
      }
    });

    // Update filter buttons
    effect(() => {
      const currentFilter = filter.value;
      document.querySelectorAll('.filter-btn').forEach(btn => {
        if (btn.dataset.filter === currentFilter) {
          btn.classList.add('active');
        } else {
          btn.classList.remove('active');
        }
      });
    });

    // Event listeners
    document.getElementById('new-todo').addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        addTodo(e.target.value);
        e.target.value = '';
      }
    });

    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        filter.value = btn.dataset.filter;
      });
    });

    document.getElementById('clear-completed').addEventListener('click', clearCompleted);

    // Initialize
    loadTodos();
  </script>
</body>
</html>
